### <a name="_b7urdng99y53"></a>**Название задачи: Передача ставок в кол-центр** 
### <a name="_hjk0fkfyohdk"></a>**Автор: Байдин Владислав Андреевич**
### <a name="_uanumrh8zrui"></a>**Дата: 30.03.2025**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| **№** | **Действующие лица или системы**  | **Use Case**                                                                                                      | **Описание**                                                                                                                                                                                                                      |
|:-----:|:----------------------------------|:------------------------------------------------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  1.   | АБС                               | Я, как система АБС, должна доставлять данные по ставкам в систему call-центра                                     | Система call-центра запрашивает данные по HTTP-протоколу, используя приватную ручку АБС-системы                                                                                                                                   |
|  1.   | АБС                               | Я, как система АБС, должна доставлять данные по ставкам в систему партнёрского call-центра                        | АБС система выполняет джобу по CRON раз в день для экспорта XLS-файлов со ставками в партнёрский call-центр                                                                                                                       |
|  2.   | Система call-центра               | Я, как система call-центра, должна запрашивать данные по ставкам по HTTP-протоколу у АБС системы                  |                                                                                                                                                                                                                                   |
|  3.   | Система патрнёрского call-центра  | Я, как система патрнёрского call-центра, могу принимать данные по ставкам по SFTP-протоколу                       |                                                                                                                                                                                                                                   |
|  4.   | Менеджер call-центра              | Я, как менеджер call-центра, могу проконсультировать клиента по телефона по актуальным ставкам банка              | Менеджер call-центра имеет возможность проконсультировать клиента по ставкам банка, потому что он может прямо во время разговора через интерфейс системы call-центра вызвать ручку АБС системы для получения процентов по ставкам |
|  5.   | Менеджер патрнёрского call-центра | Я, как менеджер патрнёрского call-центра, могу проконсультировать клиента по телефона по актуальным ставкам банка | Менеджер патрнёрского call-центра имеет возможность проконсультировать клиента по ставкам банка, потому что АБС система регулярно раз в день доставляет XLS-файлы в систему партнёрского call-центра                              |
### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно-значимые требования.

| **№** | **Требование**                                                                                                            |
|:-----:|:--------------------------------------------------------------------------------------------------------------------------|
|  1.   | API эндпоинт для передачи данных по процентам ставок должен быть доступен для вызова системой call-центра банка           |
|  2.   | CRON джоба от АБС-системы должна регулярно запускаться в интервале один раз в день                                        |
|  3.   | В случае неудачной попытки передача файла должен быть предусмотрен ретрай передачи                                        |
|  4.   | Менеджер call-центра имеет доступ в веб-интерфейсе на запрос и чтение данных по процентным ставкам банка                  |
|  4.   | Менеджер call-центра должен иметь возможность предоставить консультацию клиентам по актуальным ставкам банка              |
|  5.   | Система партнёрского call-центра должна иметь возможность импортировать данные себе для работы их менеджеров              |
|  6.   | Менеджер партнёрского call-центра должен иметь возможность предоставить консультацию клиентам по актуальным ставкам банка |
### <a name="_qmphm5d6rvi3"></a>**Решение**
### С4 Context диаграмма: 
![c4_context.drawio.png](c4_context.drawio.png)

### С4 Container диаграмма: 
![c4_container.drawio.png](c4_container.drawio.png)

Приведите диаграммы контекста и контейнеров в модели C4. Опишите там основные компоненты и интеграции всех элементов решения. 

Также опишите, какой логикой вы руководствовались в ходе принятия решений и выбора технологий. Не забывайте, что необходимо учесть все функциональные и нефункциональные требования.

Принятые архитектурные решения и логика выбора технологий:
1. Реализация серверных частей для онлайн-банка и сайта <br> Чтобы избежать прямого доступа из сайта и интернет-банка к базе данных АБС, мы реализуем отдельные серверные приложения (бэкенды) для сайта и онлайн-банка. Это позволит:
   * централизованно контролировать доступ к данным
   * реализовать бизнес-логику, связанную с валидацией и авторизацией
   * обеспечить безопасность и масштабируемость
   * снизить риски, связанные с нагрузкой на критически важную систему АБС
2. Асинхронная обработка событий через шину Kafka <br> Использование Kafka как шины данных для событийной интеграции между компонентами архитектуры даёт:
   * гибкость в расширении системы (подписка на события без изменения логики)
   * возможность масштабировать систему горизонтально
   * повышение отказоустойчивости (данные сохраняются в брокере)
   * реализацию стратегии повторных попыток (retry) для обработки ошибок
3. Создание отдельных баз данных для сайта и онлайн-банка + репликация данных из АБС <br> Для снижения нагрузки на АБС и минимизации прямого взаимодействия с ней:
   * выделяются отдельные БД под сайт и интернет-банк
   * реализуется репликация нужных данных из АБС (например, список банковских продуктов, ставки, статусы заявок)
   * предоставляется быстрый доступ к часто используемым данным
   * повышается доступность и скорость отклика пользовательских интерфейсов

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Опишите здесь наиболее важные альтернативные решения.
1. Прямой доступ сайта и онлайн-банка к базе данных АБС <br> Не изменить реализацию, при которой доступ к данным напрямую из пользовательских интерфейсов (сайта и онлайн-банка) к базе данных АБС <br>
   * Плюсы:
     * Отсутствие доработок
     * Минимум новых компонентов
   * Минусы
     * Нарушение изоляции и безопасности (критичная БД доступна извне)
     * Высокая нагрузка на АБС и её БД
     * Невозможность масштабирования под нагрузкой
     * Нарушение принципа единой бизнес-логики
2. Использование внешней CRM-платформы для обработки заявок <br> Передача всех заявок из сайта и онлайн-банка в стороннюю CRM-систему 
   * Плюсы:
     * Быстрый запуск MVP
     * Готовые инструменты по работе с заявками
   * Минусы
     * Утечка чувствительных данных через стороннюю систему
     * Трудности с безопасностью и комплаенсом
     * Высокая стоимость интеграции
     * Отсутствие гибкости под внутренние процессы банка
3. Выгрузка данных из АБС по расписанию <br> Выгрузка ставок и информации о продуктах из АБС по расписанию (например, каждый час) в отдельную БД, без шины событий Kafka
    * Плюсы:
     * Простая реализация
     * Нет зависимости от Kafka
   * Минусы
     * Данные могут быть неактуальны
     * Нет реактивности (никаких событий по изменению ставок)
     * Возможна рассинхронизация

### <a name="_bjrr7veeh80c"></a>**Недостатки**
Подробно опишите здесь недостатки, ограничения и риски выбранного решения.
1. <b>Увеличение времени и затрат на разработку:</b> внедрение Kafka, отдельные бэкенды и репликация данных потребуют времени и ресурсов
2. <b>Поддержка Kafka:</b> необходим DevOps-инженер/бэк-разработчик с опытом эксплуатации Kafka
3. <b>Риски неконсистентности данных:</b> возможны расхождения между реплицированными данными и актуальной информацией в АБС, особенно при сбоях, ручных изменений данных/структур таблиц, реплика лаги
4. <b>Сложности в реализации и отладке репликации:</b> разработка механизмов синхронизации и их надёжность требует тщательного тестирования
5. <b>Нагрузка на инфраструктуру:</b> требуется дополнительная инфраструктура для работы микросервисов, брокера Kafka, мониторинга и масштабирования
6. <b>Требуется обучение сотрудников:</b> необходимо повысить квалификацию IT-команды по новым технологиям (Kafka, асинхронная обработка, EDA, масштабирование)
